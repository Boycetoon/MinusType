I" ]<h2 id="éƒ¨åˆ†ä¾èµ–å›¾-partial-dependence-plot">éƒ¨åˆ†ä¾èµ–å›¾ Partial Dependence Plot</h2>

<p>å¦‚ä»Šæœºå™¨å­¦ä¹ ç®—æ³•åœ¨å„ä¸ªé¢†åŸŸè¢«å¹¿æ³›åº”ç”¨ï¼Œå¯¹äºä¸€äº›é¢†åŸŸçš„ç§‘ç ”æ¥è¯´ï¼Œæœºå™¨å­¦ä¹ æä¾›äº†æ›´ç²¾ç¡®ä¼°è®¡çš„å¯èƒ½ï¼Œä½†æ˜¯å…¶å¼±è§£é‡Šæ€§å´æˆä¸ºäº†æ›´æ·±å…¥ç ”ç©¶çš„é˜»åŠ›ã€‚å¯è§£é‡Šæœºå™¨å­¦ä¹ å°±æ˜¯åœ¨æœºå™¨å­¦ä¹ æ¨¡å‹çš„åŸºç¡€ä¸Šé€šè¿‡ä¸€ç³»åˆ—æ–¹æ³•ä½¿å¾—æ¨¡å‹ç»“æœå…·å¤‡å¯è§£é‡Šçš„ç‰¹æ€§ï¼Œéƒ¨åˆ†ä¾èµ–å›¾ï¼ˆPartial Dependence Plotï¼‰æ˜¾ç¤ºäº†ä¸€ä¸ªæˆ–ä¸¤ä¸ªç‰¹å¾å¯¹æœºå™¨å­¦ä¹ æ¨¡å‹çš„é¢„æµ‹ç»“æœçš„è¾¹é™…æ•ˆåº”ï¼Œç”±äºå¾ˆå¤šæœºå™¨å­¦ä¹ ç®—æ³•éå‚æ•°çš„ç‰¹æ€§ä½¿å¾—éƒ¨ä»½ä¾èµ–å›¾å¯ä»¥æ­ç¤ºçº¿æ€§ä»¥åŠéçº¿æ€§ç‰¹å¾ï¼Œå®¹æ˜“ç†è§£å¹¶ä¸”æœ‰è¾ƒé«˜çš„è§£é‡ŠåŠ›ã€‚</p>

<p>éƒ¨åˆ†ä¾èµ–å›¾ç®€æ˜“å¹¶ä¸”ç›´è§‚ï¼Œåœ¨ç§‘å­¦ç ”ç©¶ä¸­è¢«ç»å¸¸ä½¿ç”¨ï¼Œä½†åŒæ—¶å®ƒä¹Ÿå…·æœ‰ä¸€äº›é—®é¢˜ï¼š</p>

<ol>
  <li>è‡ªå˜é‡é—´å¯èƒ½å­˜åœ¨å¤æ‚çš„äº¤äº’å…³ç³»å¯¼è‡´æœ€ç»ˆçš„ç»“æœï¼Œæ‰€ä»¥å•çœ‹ä¸€ä¸ªå˜é‡çš„pdpå›¾å¯èƒ½æ˜¯ä¸å…¨é¢çš„ï¼Œç„¶è€Œç”±äºäººä»¬å¯¹å›¾å½¢ç†è§£åŠ›çš„å±€é™æ€§ï¼Œpdpå›¾æœ€å¤šåªæ”¯æŒåŒå˜é‡çš„äº¤äº’è€Œæ— æ³•è¿›è¡Œæ›´é«˜ç»´çš„äº¤äº’ï¼Œå½“ç„¶è¿™ä¸ªç¼ºé™·çš„ä¸»è¦æ¥æºæ˜¯äººä»¬çš„ä¸»è§‚ç†è§£èƒ½åŠ›æœ‰é™ã€‚</li>
  <li>ä¸€äº›pdpå›¾ä¸æ˜¾ç¤ºç‰¹å¾åˆ†å¸ƒï¼Œè¿™å¯èƒ½ä¼šäº§ç”Ÿè¯¯å¯¼ï¼Œå› ä¸ºå¯èƒ½ä¼šè¿‡åº¦è§£é‡Šå‡ ä¹æ²¡æœ‰æ•°æ®çš„åŒºåŸŸã€‚</li>
  <li>pdpå‡è®¾å…¶è®¡ç®—éƒ¨åˆ†ä¾èµ–çš„ç‰¹å¾ä¸å…¶ä»–ç‰¹å¾ä¸ç›¸å…³ï¼ˆåœ¨ä¸è¿›è¡Œäº¤äº’çš„æƒ…å†µä¸‹ï¼‰ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ç»“æœçš„è¯¯å·®ï¼Œä¸€ä¸ªè§£å†³åŠæ³•æ˜¯ä½¿ç”¨æ¡ä»¶è€Œä¸æ˜¯è¾¹é™…åˆ†å¸ƒçš„ç´¯ç§¯å±€éƒ¨æ•ˆåº”å›¾ã€‚ï¼ˆhttps://christophm.github.io/interpretable-ml-book/pdp.htmlï¼‰</li>
  <li>ç”±äºpdpç»˜åˆ¶çš„æ˜¯å¹³å‡å“åº”ï¼Œä¸ªä½“é—´çš„å¼‚è´¨æ€§å¯èƒ½æ— æ³•è¢«è§‚å¯Ÿåˆ°ï¼Œå³æœ‰å¯èƒ½ä¸ªä½“é—´çš„å˜åŒ–å·®å¼‚æ˜æ˜¾ï¼Œè¿™å¯ä»¥é€šè¿‡ä¸ªä½“æ¡ä»¶æœŸæœ›ï¼ˆIndividual Conditional Expectationï¼ŒICEï¼‰æ›²çº¿è§‚å¯Ÿåˆ°ã€‚</li>
  <li>å–å†³äºç®—æ³•çš„ç²¾åº¦ä»¥åŠéš¾ä»¥é¿å…çš„è¿‡æ‹Ÿåˆï¼Œpdpå›¾å¯èƒ½å­˜åœ¨è®¸å¤šè¾ƒå°çš„æ³¢åŠ¨æˆ–å˜åŒ–è¶‹åŠ¿ï¼Œè€Œä¸€èˆ¬è¿›è¡Œè§£é‡Šæ€§ç ”ç©¶æ—¶æ›´åŠ å…³æ³¨çš„æ˜¯æ•´ä½“çš„å˜åŒ–è¶‹åŠ¿è€Œä¸æ˜¯å±€éƒ¨å˜åŒ–ã€‚
    <h2 id="sklearnçš„pdpæ–¹æ³•">sklearnçš„pdpæ–¹æ³•</h2>
  </li>
</ol>

<p>Pythonä¸­é‡è¦çš„æœºå™¨å­¦ä¹ åŒ…sklearnåœ¨æœ€è¿‘çš„æ›´æ–°ä¸­åŠ å…¥äº†pdpå›¾çš„ç»˜åˆ¶æ–¹æ³•ï¼Œå®˜æ–¹æ¡ˆä¾‹è§ï¼š<a href="https://scikit-learn.org/stable/modules/partial_dependence.html?highlight=pdp">https://scikit-learn.org/stable/modules/partial_dependence.html?highlight=pdp</a>
<img src="https://github.com/Boycetoon/MinusType/blob/master/image/sphx_glr_plot_partial_dependence_002.png?raw=true" alt="" />
<img src="image/sphx_glr_plot_partial_dependence_0031.png" alt="" />
å¯ä»¥çœ‹åˆ°è‡ªå¸¦çš„ç»˜å›¾æ–¹æ³•å¯ä»¥ç»˜åˆ¶å•å˜é‡ä»¥åŠåŒå˜é‡äº¤äº’çš„PDPå›¾ï¼Œå¹¶ä¸”è¿˜å¯ä»¥ç»˜åˆ¶ICEå›¾ï¼Œå¹¶ä¸”ç»˜åˆ¶çš„å›¾å½¢ä¸­åŒ…æ‹¬äº†è½´é¡»å›¾ã€‚ä¸è¿‡æ ¹æ®ä¸Šè¿°çš„é—®é¢˜æ¥çœ‹ï¼Œsklearnæä¾›çš„ç»˜å›¾æ–¹æ³•è½´é¡»å›¾å¤ªè¿‡ç¨€ç–ï¼Œå¯¹æ ·æœ¬åˆ†å¸ƒçš„è¡¨å¾å¹¶ä¸ç†æƒ³ï¼›å…¶æ¬¡ç¼ºå°‘å¯¹æ›²çº¿è¿›è¡Œå¹³æ»‘æ‹Ÿåˆçš„è¡¨è¾¾ã€‚</p>
<h2 id="pdpå›¾ç»˜åˆ¶æ”¹è¿›">pdpå›¾ç»˜åˆ¶æ”¹è¿›</h2>

<p>åŸºäºä»¥ä¸Šçš„ä¸€äº›éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªè¡Œç»˜åˆ¶è‡ªå·±æƒ³è¦çš„pdpå›¾ï¼Œä¸»è¦çš„æ€è·¯å°±æ˜¯ä½¿ç”¨sklearnçš„partial_dependenceæ–¹æ³•ç›´æ¥è·å–pdçš„å€¼æ•°ç»„ï¼ˆ<a href="https://scikit-learn.org/stable/modules/generated/sklearn.inspection.partial_dependence.html?highlight=partialdependence">https://scikit-learn.org/stable/modules/generated/sklearn.inspection.partial_dependence.html?highlight=partialdependence</a>ï¼‰ï¼Œç„¶åä½¿ç”¨å…¶ä»–çš„ç»˜å›¾åŒ…è¿›è¡Œç»˜åˆ¶ã€‚</p>

<p>ä¸‹é¢æ˜¯ä¸¤ç§å®è·µçš„ä»£ç ï¼Œç¬¬ä¸€ç§åŒ…æ‹¬äº†åŸæ›²çº¿å’Œæ‹Ÿåˆçš„æ ·æ¡æ›²çº¿ï¼Œå¹¶ä¸”ä½¿ç”¨äº†æ›´å¯†çš„è½´é¡»å›¾ï¼Œç¬¬äºŒç§åœ¨ç¬¬ä¸€ç§çš„åŸºç¡€ä¸Šå¢åŠ äº†æ‰€æœ‰æ ·æœ¬ICEçš„95%ç½®ä¿¡åŒºé—´ï¼Œè¿™æ ·å¯ä»¥çœ‹å‡ºæ ·æœ¬é—´å˜åŒ–çš„å¼‚è´¨æ€§ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªç½®ä¿¡åŒºé—´æ˜¯æŠ½æ ·ä¼°è®¡çš„ï¼Œä¸ç»Ÿè®¡æ–¹æ³•ä¸­å‚æ•°ä¼°è®¡çš„ç½®ä¿¡åŒºé—´çš„æ„ä¹‰æ˜¯ä¸åŒçš„ã€‚å¦å¤–æœ‰ä¸€ä¸ªå°çš„ç»†èŠ‚æ˜¯è°ƒç”¨partial_dependenceçš„æ—¶å€™å¦‚æœä¸ä¼ å…¥methodå‚æ•°åˆ™ä¼šè‡ªåŠ¨ä½¿ç”¨â€˜recursionâ€™æ–¹æ³•ï¼Œåœ¨ä¸€äº›æ¨¡å‹ä¸­ä¼šå¯¼è‡´pdpå›¾çš„yè½´æ˜¯ä»¥0ä¸ºåŸºå‡†å€¼è€Œä¸æ˜¯ä»¥å‡å€¼ä¸ºåŸºå‡†å€¼ï¼Œè€Œå¦‚æœä½¿ç”¨â€˜bruteâ€™æ–¹æ³•åˆ™ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œä½†æ˜¯ä¼šæ¶ˆè€—æ›´å¤šçš„è®¡ç®—æ—¶é—´ã€‚</p>
<h3 id="å¸¦æ‹Ÿåˆæ›²çº¿ä¸ç‰¹å¾åˆ†å¸ƒçš„pdpå›¾">å¸¦æ‹Ÿåˆæ›²çº¿ä¸ç‰¹å¾åˆ†å¸ƒçš„pdpå›¾</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.inspection</span> <span class="kn">import</span> <span class="n">partial_dependence</span> <span class="c1"># ç›´æ¥è·å–pdpæ•°ç»„çš„æ–¹æ³•
</span><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">splev</span><span class="p">,</span> <span class="n">splrep</span> <span class="c1"># æ•°æ®å¹³æ»‘æ’å€¼
</span>
<span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">importance</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
  <span class="n">sns</span><span class="p">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s">"ticks"</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s">"deep"</span><span class="p">,</span> <span class="n">font_scale</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span>
  <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
  <span class="n">ax</span>  <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

  <span class="n">pdp</span> <span class="o">=</span> <span class="n">partial_dependence</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                           <span class="n">kind</span><span class="o">=</span><span class="s">"average"</span><span class="p">,</span> 
                           <span class="n">method</span> <span class="o">=</span> <span class="s">'brute'</span><span class="p">,</span> 
                           <span class="n">grid_resolution</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span> <span class="c1"># è·å–pdpçš„æ•°ç»„
</span>  <span class="n">plot_x</span> <span class="o">=</span> <span class="n">pdp</span><span class="p">[</span><span class="s">'values'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># æå–å€¼ä½œä¸ºxè½´
</span>  <span class="n">plot_y</span> <span class="o">=</span> <span class="n">pdp</span><span class="p">[</span><span class="s">'average'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># æå–å¹³å‡pdpä½œä¸ºyè½´æ•°æ®
</span>  <span class="n">tck</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">plot_x</span><span class="p">,</span> <span class="n">plot_y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="c1"># è¿›è¡Œæ•°æ®å¹³æ»‘ï¼Œå‚è€ƒï¼šhttps://docs.scipy.org/doc/scipy/reference/tutorial/interpolate.html?highlight=interpolate
</span>  <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">plot_x</span><span class="p">.</span><span class="nb">min</span><span class="p">(),</span><span class="n">plot_x</span><span class="p">.</span><span class="nb">max</span><span class="p">(),</span><span class="mi">300</span><span class="p">)</span>
  <span class="n">ynew</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">tck</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

  <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_x</span><span class="p">,</span> <span class="n">plot_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'k'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span> <span class="c1"># ç»˜åˆ¶åŸæ›²çº¿
</span>  <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># ç»˜åˆ¶å¹³æ»‘æ›²çº¿
</span>  <span class="n">sns</span><span class="p">.</span><span class="n">rugplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">dummy_df</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">x</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="p">.</span><span class="mi">06</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'k'</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">)</span> <span class="c1"># ä½¿ç”¨snsç»˜åˆ¶è½´é¡»å›¾
</span>
  <span class="n">x_min</span> <span class="o">=</span> <span class="n">plot_x</span><span class="p">.</span><span class="nb">min</span><span class="p">()</span><span class="o">-</span><span class="p">(</span><span class="n">plot_x</span><span class="p">.</span><span class="nb">max</span><span class="p">()</span><span class="o">-</span><span class="n">plot_x</span><span class="p">.</span><span class="nb">min</span><span class="p">())</span><span class="o">*</span><span class="mf">0.1</span> <span class="c1"># å®šä¹‰xè½´çš„ä¸‹é™
</span>  <span class="n">x_max</span> <span class="o">=</span> <span class="n">plot_x</span><span class="p">.</span><span class="nb">max</span><span class="p">()</span><span class="o">+</span><span class="p">(</span><span class="n">plot_x</span><span class="p">.</span><span class="nb">max</span><span class="p">()</span><span class="o">-</span><span class="n">plot_x</span><span class="p">.</span><span class="nb">min</span><span class="p">())</span><span class="o">*</span><span class="mf">0.1</span> <span class="c1"># å®šä¹‰Xè½´çš„ä¸Šé™
</span>  <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Partial Dependence Plot of '</span><span class="o">+</span><span class="n">i</span> <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Partial Dependence'</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">x_max</span><span class="p">)</span> <span class="c1"># å®šä¹‰Xè½´çš„ä¸Šä¸‹é™ï¼Œä¸ºäº†é˜²æ­¢è½´é¡»å›¾ä¸­çš„ç¦»æ•£å€¼æ”¹å˜äº†åæ ‡è½´å®šä½
</span>  <span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'./pdpplot_'</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s">'.jpg'</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>ç»˜åˆ¶ç»“æœå¦‚ä¸‹ï¼š</strong>
<img src="https://github.com/Boycetoon/MinusType/blob/master/image/pdpplot_bta_800.jpg?raw=true" alt="" /></p>
<h3 id="å¸¦iceç½®ä¿¡åŒºé—´çš„pdpå›¾">å¸¦ICEç½®ä¿¡åŒºé—´çš„pdpå›¾</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.inspection</span> <span class="kn">import</span> <span class="n">partial_dependence</span> <span class="c1"># ç›´æ¥è·å–pdpæ•°ç»„çš„æ–¹æ³•
</span><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">splev</span><span class="p">,</span> <span class="n">splrep</span> <span class="c1"># æ•°æ®å¹³æ»‘æ’å€¼
</span>
<span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">importance</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
  <span class="n">pdp</span> <span class="o">=</span> <span class="n">partial_dependence</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s">"both"</span><span class="p">,</span> <span class="n">grid_resolution</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span> <span class="c1"># è¿™é‡Œé‡‡ç”¨äº†bothæ–¹æ³•ï¼Œé™¤äº†pdpå‡å€¼å¤–ä¼šè®¡ç®—å‡ºæ¯ä¸ªæ ·æœ¬çš„ice
</span>  <span class="n">sns</span><span class="p">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s">"ticks"</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s">"deep"</span><span class="p">,</span> <span class="n">font_scale</span> <span class="o">=</span> <span class="mf">1.1</span><span class="p">)</span>
  <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
  <span class="n">ax</span>  <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

  <span class="n">plot_x</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pdp</span><span class="p">[</span><span class="s">'values'</span><span class="p">][</span><span class="mi">0</span><span class="p">]).</span><span class="n">rename</span><span class="p">(</span><span class="s">'x'</span><span class="p">)</span>
  <span class="n">plot_i</span> <span class="o">=</span> <span class="n">pdp</span><span class="p">[</span><span class="s">'individual'</span><span class="p">]</span> <span class="c1">#è·å–æ¯ä¸ªæ ·æœ¬çš„iceæ•°ç»„
</span>  <span class="n">plot_y</span> <span class="o">=</span> <span class="n">pdp</span><span class="p">[</span><span class="s">'average'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">tck</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">plot_x</span><span class="p">,</span> <span class="n">plot_y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
  <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">plot_x</span><span class="p">.</span><span class="nb">min</span><span class="p">(),</span><span class="n">plot_x</span><span class="p">.</span><span class="nb">max</span><span class="p">(),</span><span class="mi">300</span><span class="p">)</span>
  <span class="n">ynew</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">tck</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

  <span class="n">plot_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'x'</span><span class="p">,</span><span class="s">'y'</span><span class="p">])</span> <span class="c1"># å®šä¹‰ä¸€ä¸ªæ–°dfï¼ŒåŒ…æ‹¬x yä¸¤åˆ—
</span>  <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">plot_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c1"># éå†æ¯ä¸ªæ ·æœ¬çš„ice
</span>      <span class="n">a2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">Series</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
      <span class="n">df_i</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">plot_x</span><span class="p">,</span> <span class="n">a2</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="s">'y'</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># å°†iceä¸xæ¨ªå‘æ‹¼æ¥
</span>      <span class="n">plot_df</span> <span class="o">=</span> <span class="n">plot_df</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_i</span><span class="p">)</span> <span class="c1"># åŠ å…¥åˆ°æ€»è¡¨ä¸­
</span>
  <span class="n">sns</span><span class="p">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">plot_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"y"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'k'</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'--'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span> <span class="c1"># ä½¿ç”¨snsç»˜åˆ¶çº¿å›¾ï¼Œå¦‚æœåŒä¸€ä¸ªxä¸Šæœ‰å¤šä¸ªyçš„è¯å°†ä¼šè‡ªåŠ¨ç”Ÿæˆ95%ç½®ä¿¡åŒºé—´
</span>  <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  
  <span class="n">sns</span><span class="p">.</span><span class="n">rugplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">dummy_df</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">x</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="p">.</span><span class="mi">05</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'k'</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">)</span>

  <span class="n">x_min</span> <span class="o">=</span> <span class="n">plot_x</span><span class="p">.</span><span class="nb">min</span><span class="p">()</span><span class="o">-</span><span class="p">(</span><span class="n">plot_x</span><span class="p">.</span><span class="nb">max</span><span class="p">()</span><span class="o">-</span><span class="n">plot_x</span><span class="p">.</span><span class="nb">min</span><span class="p">())</span><span class="o">*</span><span class="mf">0.1</span>
  <span class="n">x_max</span> <span class="o">=</span> <span class="n">plot_x</span><span class="p">.</span><span class="nb">max</span><span class="p">()</span><span class="o">+</span><span class="p">(</span><span class="n">plot_x</span><span class="p">.</span><span class="nb">max</span><span class="p">()</span><span class="o">-</span><span class="n">plot_x</span><span class="p">.</span><span class="nb">min</span><span class="p">())</span><span class="o">*</span><span class="mf">0.1</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Partial Dependence Plot of '</span><span class="o">+</span><span class="n">i</span> <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Partial Dependence'</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">x_max</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'./pdpplot_'</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s">'.jpg'</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>ç»˜åˆ¶ç»“æœå¦‚ä¸‹ï¼š</strong>
<img src="https://github.com/Boycetoon/MinusType/blob/master/image/pdpplot_bta_800-1623041867417.jpg" alt="" /></p>
:ET